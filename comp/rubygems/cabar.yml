<%
  # Calls ruby to get information about rubygems.
  rubygems_info = begin
    eval `unset GEMPATH; ruby -r rubygems -r rubygems/rubygems_version -e 'x = { :version => Gem::RubyGemsVersion, :GEM_PATH => Gem.path }; puts x.inspect;'`.chomp
  rescue 
    nil
  end

  case rubygems_info
  when Hash
    rubygems_info[:installed] = true
  else 
    rubygems_info = { :installed => false }
  end
#  require 'pp'	  
#  pp rubygems_info
  # Jer: WHAT IS THIS WORKING-AROUND? -- kurt 2009/06/15
  # This entire mechanisim for introspecting on rubygems is flawed, it happens too early in
  # in the component resolution. -- Jer
  rubygems_info[:installed] = true
 %>
cabar:
  version: '1.0'
  enabled: <%= rubygems_info[:installed].inspect %>
  component:
    name: rubygems
    version: v<%= rubygems_info[:version] || '0.1' %>
    description: "Rubygems - Cabar support facets"
    standard_gem_path: <%= rubygems_info[:GEM_PATH].inspect %>
  plugin: 'cabar.rb'
  requires:
    component:
      ruby: true
      cabar: true

